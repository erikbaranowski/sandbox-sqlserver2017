#!/usr/bin/expect -f
#
# This Expect script was generated by autoexpect on Wed Jun 19 00:08:24 2019
# Expect and autoexpect were both written by Don Libes, NIST.
#
# Note that autoexpect does not guarantee a working script.  It
# necessarily has to guess about certain things.  Two reasons a script
# might fail are:
#
# 1) timing - A surprising number of programs (rn, ksh, zsh, telnet,
# etc.) and devices discard or ignore keystrokes that arrive "too
# quickly" after prompts.  If you find your new script hanging up at
# one spot, try adding a short sleep just before the previous send.
# Setting "force_conservative" to 1 (see below) makes Expect do this
# automatically - pausing briefly before sending each character.  This
# pacifies every program I know of.  The -c flag makes the script do
# this in the first place.  The -C flag allows you to define a
# character to toggle this mode off and on.

set force_conservative 0  ;# set to 1 to force conservative mode even if
			  ;# script wasn't run conservatively originally
if {$force_conservative} {
	set send_slow {1 .1}
	proc send {ignore arg} {
		sleep .1
		exp_send -s -- $arg
	}
}

#
# 2) differing output - Some programs produce different output each time
# they run.  The "date" command is an obvious example.  Another is
# ftp, if it produces throughput statistics at the end of a file
# transfer.  If this causes a problem, delete these patterns or replace
# them with wildcards.  An alternative is to use the -p flag (for
# "prompt") which makes Expect only look for the last line of output
# (i.e., the prompt).  The -P flag allows you to define a character to
# toggle this mode off and on.
#
# Read the man page for more info.
#
# -Don


set timeout -1
spawn yum install -y mssql-tools unixODBC-devel
match_max 100000
expect -exact "Loaded plugins: fastestmirror\r
Loading mirror speeds from cached hostfile\r
 * base: mirror.clarkson.edu\r
 * extras: mirror.es.its.nyu.edu\r
 * updates: mirror.clarkson.edu\r
\rpackages-microsoft-com-prod                              | 2.9 kB     00:00     \r
\rpackages-microsoft-com-pro 0% \[                 \]  0.0 B/s |    0 B   --:-- ETA \r\rpackages-microsoft-com-prod/primary_db                     | 170 kB   00:01     \r
Resolving Dependencies\r
--> Running transaction check\r
---> Package mssql-tools.x86_64 0:17.3.0.1-1 will be installed\r
--> Processing Dependency: msodbcsql17 < 17.4.0.0 for package: mssql-tools-17.3.0.1-1.x86_64\r
--> Processing Dependency: msodbcsql17 >= 17.3.0.0 for package: mssql-tools-17.3.0.1-1.x86_64\r
---> Package unixODBC-devel.x86_64 0:2.3.7-1.rh will be installed\r
--> Processing Dependency: unixODBC = 2.3.7 for package: unixODBC-devel-2.3.7-1.rh.x86_64\r
--> Running transaction check\r
---> Package msodbcsql17.x86_64 0:17.3.1.1-1 will be installed\r
---> Package unixODBC.x86_64 0:2.3.7-1.rh will be installed\r
--> Finished Dependency Resolution\r
\r
Dependencies Resolved\r
\r
================================================================================\r
 Package           Arch      Version       Repository                      Size\r
================================================================================\r
Installing:\r
 mssql-tools       x86_64    17.3.0.1-1    packages-microsoft-com-prod    254 k\r
 unixODBC-devel    x86_64    2.3.7-1.rh    packages-microsoft-com-prod     42 k\r
Installing for dependencies:\r
 msodbcsql17       x86_64    17.3.1.1-1    packages-microsoft-com-prod    769 k\r
 unixODBC          x86_64    2.3.7-1.rh    packages-microsoft-com-prod    213 k\r
\r
Transaction Summary\r
================================================================================\r
Install  2 Packages (+2 Dependent packages)\r
\r
Total download size: 1.2 M\r
Installed size: 1.2 M\r
Downloading packages:\r
\r(2/4): mssql-tools-17.3.0. 0% \[                 \]  0.0 B/s |    0 B   --:-- ETA \r\r(1/4): mssql-tools-17.3.0.1-1.x86_64.rpm                   | 254 kB   00:00     \r
\r(2/4): msodbcsql17-17.3.1.1-1.x86_64.rpm                   | 769 kB   00:00     \r
\r(3/4): unixODBC-2.3.7-1.rh.x86_64.rpm                      | 213 kB   00:00     \r
\r(4/4): unixODBC-devel-2.3.7-1.rh.x86_64.rpm                |  42 kB   00:00     \r
--------------------------------------------------------------------------------\r
Total                                              1.3 MB/s | 1.2 MB  00:00     \r
Running transaction check\r
Running transaction test\r
Transaction test succeeded\r
Running transaction\r
\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[                               \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[#                              \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[##                             \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[###                            \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[####                           \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[#####                          \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[########                       \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[##########                     \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[#############                  \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[################               \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[###################            \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[######################         \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[########################       \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[##########################     \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[#############################  \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64 \[############################## \] 1/4\r  Installing : unixODBC-2.3.7-1.rh.x86_64                                   1/4 \r
The license terms for this product can be downloaded from\r
https://aka.ms/odbc17eula and found in\r
/usr/share/doc/msodbcsql17/LICENSE.txt . By entering 'YES',\r
you indicate that you accept the license terms.\r
\r
Do you accept the license terms? (Enter YES or NO)\r
"
send -- "YES\r"
expect -exact "YES\r
\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[                             \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#                            \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[##                           \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[###                          \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[####                         \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#####                        \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[######                       \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#######                      \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[########                     \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#########                    \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[##########                   \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[###########                  \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[############                 \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#############                \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[##############               \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[###############              \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[################             \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#################            \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[##################           \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[###################          \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[####################         \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#####################        \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[######################       \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#######################      \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[########################     \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[#########################    \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[##########################   \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[###########################  \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_6 \[############################ \] 2/4\r  Installing : msodbcsql17-17.3.1.1-1.x86_64                                2/4 \r
The license terms for this product can be downloaded from\r
http://go.microsoft.com/fwlink/?LinkId=746949 and found in\r
/usr/share/doc/mssql-tools/LICENSE.txt . By entering 'YES',\r
you indicate that you accept the license terms.\r
\r
Do you accept the license terms? (Enter YES or NO)\r
"
send -- "YES\r"
expect eof
